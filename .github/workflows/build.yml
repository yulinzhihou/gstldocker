name: build docker images for multi platforms

on:
  push:
    branches:
      [ master ]

jobs:
  job1:
    name: build gs server for cenos6.10
    # 运行所需要的虚拟机环境。它是必填字段
    runs-on: ubuntu-latest
    steps:
      - name: print a greeting
        env: 
          MY_VAR: Hi there! My name is
          FIRST_NAME: Mona
          MIDDLE_NAME: The
          LAST_NAME: Octocat
        run: |
          echo $MY_VAR $FIRST_NAME $MIDDLE_NAME $LAST_NAME.

      - name: Checkout
        uses: actions/checkout@v4

      - name: Get current date
        id: date
        run: echo "::set-output name=today::$(date +'%Y-%m-%d_%H-%M')"

      # - name: Set up QEMU
      #   uses: docker/setup-qemu-action@v3
      # - name: Set up Docker Buildx
      #   id: buildx
      #   uses: docker/setup-buildx-action@v3

      # - name: Available platforms
      #   run: echo ${{ steps.buildx.outputs.platforms }}

      - name: Login to DockerHub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}

      - name: Build and push
        uses: docker/build-push-action@v6
        with:
          context: .
          file: ./services/gsserver/Dockerfile
          # 所需要的体系结构，可以在 Available platforms 步骤中获取所有的可用架构
          platforms: linux/amd64,linux/arm64/v8
          # 镜像推送时间
          push: ${{ github.event_name != 'pull_request' }}
          # 给清单打上多个标签
          tags: |
            gs/centos6.10:${{ steps.date.outputs.today }}
            gs/centos6.10:latest

  # job2:
  #   name: build gs server for centos7.10

  # job3:
  #   name: build gs mysql5.1

  # job4:
  #   name: build gs mysql5.7

  # job5:
  #   name: build gs mysql8.0

  # job6:
  #   name: build gs mysql8.1

  # job7:
  #   name: build gs mysql8.4

  # job8:
  #   name: build gs php 5.6

  # job9:
  #   name: build gs php 7.0
  # job10:
  #   name: build gs php 7.1
  # job11:
  #   name: build gs php 7.2
  # job12:
  #   name: build gs php 7.3
  # job13:
  #   name: build gs php 7.4
  # job14:
  #   name: build gs php 8.0
  # job15:
  #   name: build gs php 8.1
  # job16:
  #   name: build gs php 8.2
  # job17:
  #   name: build gs php 8.3
  # job18:
  #   name: build gs php 8.4
  # job19:
  #   name: build gs billing

  # job20:
  #   name: build gs nc clinet for frpc061

  # job21:
  #   name: build gs ns server for frps061

  # job22:
  #   name: build gs nginx for 1.24.0

  # job23:
  #   name: build gs caddy server

  # job24:
  #   name: build gs redis

  # job25:
  #   name: build gs rdkafka
  